{"version":3,"file":"bundle.js","sources":["../dist/es6/index.js","src/demo.ts"],"sourcesContent":["import { createClass as _createClass, classCallCheck as _classCallCheck, defineProperty as _defineProperty } from './_virtual/_rollupPluginBabelHelpers.js';\n\n/**\n * Add scrolling state(top / not-top / bottom / not-bottom)\n *\n * @author   Hiroshi Fukuda <info.sygnas@gmail.com>\n * @license  MIT\n */\n///////////////////////////////////////\n// 状態を付与するためのdata属性\nvar ATTR_NAME = \"data-scroll-amount\"; // 状態の名前\n\nvar ATTR_TOP = \"top\";\nvar ATTR_BOTTOM = \"bottom\";\nvar ATTR_NOT_TOP = \"not-top\";\nvar ATTR_NOT_BOTTOM = \"not-bottom\";\nvar ATTR_POSITION = \"data-position\"; // 監視用エレメントのデフォルトstyle\n\nvar COMMON_STYLE = {\n  position: \"absolute\",\n  left: \"0\"\n}; // IntersectionObserverの設定\n\nvar OBSERVER_OPT = {\n  root: null,\n  rootMargin: \"0px\",\n  threshold: 0\n}; ///////////////////////////////////////\n\nvar SygScrollAmount = /*#__PURE__*/function () {\n  // private observers: IntersectionObserver[];\n\n  /**\n   * コンストラクタ\n   * @param target string 状態を付与する対象エレメントのセレクタ文字列\n   */\n  function SygScrollAmount(target) {\n    var options = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : {};\n\n    _classCallCheck(this, SygScrollAmount);\n\n    _defineProperty(this, \"opt\", void 0);\n\n    _defineProperty(this, \"targets\", void 0);\n\n    _defineProperty(this, \"isTop\", void 0);\n\n    _defineProperty(this, \"isBottom\", void 0);\n\n    _defineProperty(this, \"lastState\", void 0);\n\n    var defaults = {\n      // 最上部のオフセット\n      offsetTop: \"70px\",\n      // 最下部のオフセット\n      offsetBottom: \"70px\",\n      // 最上部にスクロールした時に実行\n      onTop: function onTop() {},\n      // 最上部から離れた時に実行\n      onNotTop: function onNotTop() {},\n      // 最下部にスクロールした時に実行\n      onBottom: function onBottom() {},\n      // 最下部から離れた時に実行\n      onNotBottom: function onNotBottom() {}\n    }; // 与えられた設定を適用\n\n    this.opt = Object.assign(defaults, options); // 状態付与の対象\n\n    this.targets = document.querySelectorAll(target); // 一番上にスクロールした\n\n    this.isTop = false; // 一番下にスクロールした\n\n    this.isBottom = false; // 最後の状態\n\n    this.lastState = '';\n    this.start();\n  }\n  /**\n   * 監視用エレメント作成して監視開始\n   */\n\n\n  _createClass(SygScrollAmount, [{\n    key: \"createObserveElement\",\n    value: function createObserveElement(position) {\n      var element = document.createElement(\"div\");\n      Object.assign(element.style, COMMON_STYLE);\n      element.style.height = this.opt.offsetTop;\n      element.setAttribute(ATTR_POSITION, position);\n\n      if (position === \"top\") {\n        element.style.top = \"0\";\n      } else {\n        element.style.bottom = \"0\";\n      } // ページ最下部に追加\n\n\n      document.body.appendChild(element);\n      return element;\n    }\n    /**\n     * スクロール検知処理を開始\n     */\n\n  }, {\n    key: \"start\",\n    value: function start() {\n      // <body> に position 設定\n      document.body.style.position = \"relative\"; // IntersectionObserverを作成して監視開始\n\n      var observer = new IntersectionObserver(this.observerCallback.bind(this), OBSERVER_OPT); // 監視用エレメント作成\n\n      observer.observe(this.createObserveElement(\"top\"));\n      observer.observe(this.createObserveElement(\"bottom\"));\n    }\n    /**\n     * スクロール処理\n     * IntersectionObserver に反応した <div> が top/bottom どちらかで判定する\n     */\n\n  }, {\n    key: \"observerCallback\",\n    value: function observerCallback(entries) {\n      var _this = this;\n\n      entries.forEach(function (entry) {\n        var position = entry.target.getAttribute(ATTR_POSITION);\n\n        if (position === \"top\") {\n          _this.isTop = entry.isIntersecting;\n        } else {\n          _this.isBottom = entry.isIntersecting;\n        }\n      }); // 属性を付与\n\n      this.setAttribute();\n    }\n    /**\n     * 属性を付与\n     */\n\n  }, {\n    key: \"setAttribute\",\n    value: function setAttribute() {\n      var state = [this.isTop ? ATTR_TOP : ATTR_NOT_TOP, this.isBottom ? ATTR_BOTTOM : ATTR_NOT_BOTTOM].join(' '); // 結果を data属性に反映する\n      // 前回と同じなら反映しない\n\n      if (state !== this.lastState) {\n        this.lastState = state;\n        this.targets.forEach(function (target) {\n          target.setAttribute(ATTR_NAME, state);\n        }); // オプション関数を実行\n\n        if (this.isTop && this.opt.onTop) {\n          this.opt.onTop();\n        } else if (this.opt.onNotTop) {\n          this.opt.onNotTop();\n        }\n\n        if (this.isBottom && this.opt.onBottom) {\n          this.opt.onBottom();\n        } else if (this.opt.onNotBottom) {\n          this.opt.onNotBottom();\n        }\n      }\n    }\n  }]);\n\n  return SygScrollAmount;\n}();\n\nexport { SygScrollAmount as default };\n//# sourceMappingURL=index.js.map\n",null],"names":["ATTR_NAME","ATTR_TOP","ATTR_BOTTOM","ATTR_NOT_TOP","ATTR_NOT_BOTTOM","ATTR_POSITION","COMMON_STYLE","position","left","OBSERVER_OPT","root","rootMargin","threshold","SygScrollAmount","options","defaults","offsetTop","offsetBottom","onTop","onNotTop","onBottom","onNotBottom","Object","document","element","observer","entries","entry","state","target","ScrollAmount","console","log"],"mappings":"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"}