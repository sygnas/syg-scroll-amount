{"version":3,"file":"syg-scroll-amount.es.js","sources":["../node_modules/syg-throttle/src/index.js","../src/index.js"],"sourcesContent":["\nexport default function (timing, func, scope) {\n    let id = null;\n\n    return function () {\n        if (id !== null) return;\n        func.apply(scope);\n\n        id = setTimeout(function () {\n            id = null;\n        }, timing);\n    };\n}","/**\n * Add scrolling state(top / not-top / bottom / not-bottom)\n *\n * @author   Hiroshi Fukuda <info.sygnas@gmail.com>\n * @license  MIT\n */\n\nimport throttle from 'syg-throttle';\n\nconst ATTR_NAME = 'data-scroll-amount';\nconst ATTR_TOP = 'top';\nconst ATTR_BOTTOM = 'bottom';\nconst ATTR_NOT_TOP = 'not-top';\nconst ATTR_NOT_BOTTOM = 'not-bottom';\n\nexport default class {\n\n    /**\n     * コンストラクタ\n     * @param {string} target DOM Selector\n     * @param {object} options\n     */\n    constructor(target, options = {}) {\n\n        const defaults = {\n            // 最上部のオフセット\n            offset_top: 70,\n            // 最下部のオフセット\n            offset_bottom: 70,\n            // 最上部にスクロールした時に実行\n            onTop() { },\n            // 最上部から離れた時に実行\n            onNotTop() { },\n            // 最下部にスクロールした時に実行\n            onBottom() { },\n            // 最下部から離れた時に実行\n            onNotBottom() { }\n        };\n\n        this.opt = Object.assign(defaults, options);\n        this.target = document.querySelectorAll(target);\n        this.win_height = null; // ブラウザウィンドウの高さ\n        this.interval_id = null; // スクロールイベントのインターバルチェック\n        this.results = []; // data属性に書き出す内容\n        this.last_results_str = null;\n        this.is_started = false; // 開始した\n        this.is_top = false; // 一番上にスクロールした\n        this.is_bottom = false; // 一番下にスクロールした\n\n        this.ev_resize = null;\n        this.ev_scroll = null;\n\n        // 開始\n        this.start();\n    }\n\n    /** *******************\n     * public\n     */\n\n    /**\n    * スクロール検知処理を開始\n    */\n    start() {\n        // すでに開始していたら無視\n        if (this.is_started) return;\n\n        // イベントオブジェクト\n        this.ev_resize = throttle(50, this._resize, this);\n        this.ev_scroll = throttle(100, this._scroll, this);\n\n        // リサイズイベントでドキュメント高さチェック\n        this._resize();\n        window.addEventListener('resize', this.ev_resize);\n\n        // スクロールイベント\n        this._scroll();\n        this.is_started = true;\n        window.addEventListener('scroll', this.ev_scroll);\n\n        // 0.5秒間毎にチェックも入れる\n        this.interval_id = setInterval(() => { this._scroll(); }, 500);\n    }\n\n    /**\n    * スクロール検知処理を停止\n    */\n    stop() {\n        window.removeEventListener('resize', this.ev_resize);\n        window.removeEventListener('scroll', this.ev_scroll);\n        clearInterval(this.interval_id);\n    }\n\n    /** *******************\n     * private\n     */\n\n    /**\n    * スクロール処理\n    */\n    _scroll() {\n        const scroll_top = window.pageYOffset;\n\n        // 初期化\n        this.results = [];\n\n        // 位置イベントのチェック\n        this._check_top_and_bottom(scroll_top);\n\n        // 属性を付与\n        this._set_attribute();\n    }\n\n    /**\n     * 属性を付与\n     */\n    _set_attribute() {\n        const results_str = this.results.join(' ');\n\n        // 結果を data属性に反映する\n        // 前回と同じなら反映しない\n        if (results_str !== this.last_results_str) {\n            this.last_results_str = results_str;\n            get_node_array(this.target).forEach((target) => {\n                target.setAttribute(ATTR_NAME, results_str);\n            });\n        }\n    }\n\n    /**\n    * 最上部か最下部かのチェック\n    */\n    _check_top_and_bottom(scroll_top) {\n        const opt = this.opt;\n        const doc_height = document.documentElement.scrollHeight;\n        const scroll_bottom = doc_height - this.win_height;\n\n        // 最上部か\n        if (scroll_top <= opt.offset_top) {\n            // ページ最上部\n            if (!this.is_top) opt.onTop();\n            this.is_top = true;\n            this.results.push(ATTR_TOP);\n\n        } else {\n            // 最上部から離れた\n            if (this.is_top) opt.onNotTop();\n            this.is_top = false;\n            this.results.push(ATTR_NOT_TOP);\n        }\n\n        // 最下部か\n        if (scroll_top >= scroll_bottom - opt.offset_bottom) {\n            // ページ最下部\n            if (!this.is_bottom) opt.onBottom();\n            this.is_bottom = true;\n            this.results.push(ATTR_BOTTOM);\n\n        } else {\n            // 最下部から離れた\n            if (this.is_bottom) opt.onNotBottom();\n            this.is_bottom = false;\n            this.results.push(ATTR_NOT_BOTTOM);\n        }\n    }\n\n    /**\n    * ウィンドウをリサイズしたら高さなどをチェック\n    */\n    _resize() {\n        this.win_height = window.window.innerHeight;\n    }\n}\n\n\n\n/**\n * NodeListをArrayとして取り出す（IE対策）\n */\nfunction get_node_array(node_list) {\n    return Array.prototype.slice.call(node_list, 0);\n}\n"],"names":["timing","func","scope","id","apply","setTimeout","ATTR_NAME","ATTR_TOP","ATTR_BOTTOM","ATTR_NOT_TOP","ATTR_NOT_BOTTOM","target","options","defaults","opt","Object","assign","document","querySelectorAll","win_height","interval_id","results","last_results_str","is_started","is_top","is_bottom","ev_resize","ev_scroll","start","throttle","_resize","_scroll","addEventListener","setInterval","removeEventListener","scroll_top","window","pageYOffset","_check_top_and_bottom","_set_attribute","results_str","join","forEach","setAttribute","doc_height","documentElement","scrollHeight","scroll_bottom","offset_top","onTop","push","onNotTop","offset_bottom","onBottom","onNotBottom","innerHeight","get_node_array","node_list","Array","prototype","slice","call"],"mappings":"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"}