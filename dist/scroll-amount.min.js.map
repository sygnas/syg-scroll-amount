{"version":3,"file":"scroll-amount.min.js","sources":["../src/index.js"],"sourcesContent":["/**\n * Add scrolling state(top / not-top / bottom / not-bottom)\n *\n * @author   Hiroshi Fukuda <info.sygnas@gmail.com>\n * @license  MIT\n */\n\nimport throttle from '@sygnas/throttle';\n\nconst ATTR_NAME = 'data-scroll-amount';\nconst ATTR_TOP = 'top';\nconst ATTR_BOTTOM = 'bottom';\nconst ATTR_NOT_TOP = 'not-top';\nconst ATTR_NOT_BOTTOM = 'not-bottom';\n\nexport default class {\n\n    /**\n     * コンストラクタ\n     * @param {string} target DOM Selector\n     * @param {object} options\n     */\n    constructor(target, options = {}) {\n\n        const defaults = {\n            // 最上部のオフセット\n            offset_top: 70,\n            // 最下部のオフセット\n            offset_bottom: 70,\n            // 最上部にスクロールした時に実行\n            onTop() { },\n            // 最上部から離れた時に実行\n            onNotTop() { },\n            // 最下部にスクロールした時に実行\n            onBottom() { },\n            // 最下部から離れた時に実行\n            onNotBottom() { }\n        };\n\n        this.opt = Object.assign(defaults, options);\n        this.target = document.querySelectorAll(target);\n        this.win_height = null; // ブラウザウィンドウの高さ\n        this.interval_id = null; // スクロールイベントのインターバルチェック\n        this.results = []; // data属性に書き出す内容\n        this.last_results_str = null;\n        this.is_started = false; // 開始した\n        this.is_top = false; // 一番上にスクロールした\n        this.is_bottom = false; // 一番下にスクロールした\n\n        this.ev_resize = null;\n        this.ev_scroll = null;\n\n        // 開始\n        this.start();\n    }\n\n    /** *******************\n     * public\n     */\n\n    /**\n    * スクロール検知処理を開始\n    */\n    start() {\n        // すでに開始していたら無視\n        if (this.is_started) return;\n\n        // イベントオブジェクト\n        this.ev_resize = throttle(50, this._resize, this);\n        this.ev_scroll = throttle(100, this._scroll, this);\n\n        // リサイズイベントでドキュメント高さチェック\n        this._resize();\n        window.addEventListener('resize', this.ev_resize);\n\n        // スクロールイベント\n        this._scroll();\n        this.is_started = true;\n        window.addEventListener('scroll', this.ev_scroll);\n\n        // 0.5秒間毎にチェックも入れる\n        this.interval_id = setInterval(() => { this._scroll(); }, 500);\n    }\n\n    /**\n    * スクロール検知処理を停止\n    */\n    stop() {\n        window.removeEventListener('resize', this.ev_resize);\n        window.removeEventListener('scroll', this.ev_scroll);\n        clearInterval(this.interval_id);\n    }\n\n    /** *******************\n     * private\n     */\n\n    /**\n    * スクロール処理\n    */\n    _scroll() {\n        const scroll_top = window.pageYOffset;\n\n        // 初期化\n        this.results = [];\n\n        // 位置イベントのチェック\n        this._check_top_and_bottom(scroll_top);\n\n        // 属性を付与\n        this._set_attribute();\n    }\n\n    /**\n     * 属性を付与\n     */\n    _set_attribute() {\n        const results_str = this.results.join(' ');\n\n        // 結果を data属性に反映する\n        // 前回と同じなら反映しない\n        if (results_str !== this.last_results_str) {\n            this.last_results_str = results_str;\n            get_node_array(this.target).forEach((target) => {\n                target.setAttribute(ATTR_NAME, results_str);\n            });\n        }\n    }\n\n    /**\n    * 最上部か最下部かのチェック\n    */\n    _check_top_and_bottom(scroll_top) {\n        const opt = this.opt;\n        const doc_height = document.documentElement.scrollHeight;\n        const scroll_bottom = doc_height - this.win_height;\n\n        // 最上部か\n        if (scroll_top <= opt.offset_top) {\n            // ページ最上部\n            if (!this.is_top) opt.onTop();\n            this.is_top = true;\n            this.results.push(ATTR_TOP);\n\n        } else {\n            // 最上部から離れた\n            if (this.is_top) opt.onNotTop();\n            this.is_top = false;\n            this.results.push(ATTR_NOT_TOP);\n        }\n\n        // 最下部か\n        if (scroll_top >= scroll_bottom - opt.offset_bottom) {\n            // ページ最下部\n            if (!this.is_bottom) opt.onBottom();\n            this.is_bottom = true;\n            this.results.push(ATTR_BOTTOM);\n\n        } else {\n            // 最下部から離れた\n            if (this.is_bottom) opt.onNotBottom();\n            this.is_bottom = false;\n            this.results.push(ATTR_NOT_BOTTOM);\n        }\n    }\n\n    /**\n    * ウィンドウをリサイズしたら高さなどをチェック\n    */\n    _resize() {\n        this.win_height = window.window.innerHeight;\n    }\n}\n\n\n\n/**\n * NodeListをArrayとして取り出す（IE対策）\n */\nfunction get_node_array(node_list) {\n    return Array.prototype.slice.call(node_list, 0);\n}\n"],"names":["target","options","opt","Object","assign","document","querySelectorAll","win_height","interval_id","results","last_results_str","is_started","is_top","is_bottom","ev_resize","ev_scroll","start","this","throttle","_resize","_scroll","addEventListener","setInterval","removeEventListener","scroll_top","window","pageYOffset","_check_top_and_bottom","_set_attribute","results_str","join","node_list","Array","prototype","slice","call","forEach","setAttribute","scroll_bottom","documentElement","scrollHeight","offset_top","onTop","push","onNotTop","offset_bottom","onBottom","onNotBottom","innerHeight"],"mappings":"6pBAsBgBA,OAAQC,2EAiBXC,IAAMC,OAAOC,mBAbF,iBAEG,4FAWgBH,QAC9BD,OAASK,SAASC,iBAAiBN,QACnCO,WAAa,UACbC,YAAc,UACdC,gBACAC,iBAAmB,UACnBC,YAAa,OACbC,QAAS,OACTC,WAAY,OAEZC,UAAY,UACZC,UAAY,UAGZC,6DAYDC,KAAKN,kBAGJG,UAAYI,EAAS,GAAID,KAAKE,QAASF,WACvCF,UAAYG,EAAS,IAAKD,KAAKG,QAASH,WAGxCE,iBACEE,iBAAiB,SAAUJ,KAAKH,gBAGlCM,eACAT,YAAa,SACXU,iBAAiB,SAAUJ,KAAKF,gBAGlCP,YAAcc,YAAY,aAAaF,WAAc,4CAOnDG,oBAAoB,SAAUN,KAAKH,kBACnCS,oBAAoB,SAAUN,KAAKF,yBAC5BE,KAAKT,mDAWbgB,EAAaC,OAAOC,iBAGrBjB,gBAGAkB,sBAAsBH,QAGtBI,8DAOCC,EAAcZ,KAAKR,QAAQqB,KAAK,KAIlCD,IAAgBZ,KAAKP,wBAChBA,iBAAmBmB,EAsDpC,SAGwBE,UACbC,MAAMC,UAAUC,MAAMC,KAAKJ,EAAW,IAzDtBd,KAAKjB,QAAQoC,QAAQ,SAACpC,KAC1BqC,aAnHL,qBAmH6BR,oDAQrBL,OACZtB,EAAMe,KAAKf,IAEXoC,EADajC,SAASkC,gBAAgBC,aACTvB,KAAKV,WAGpCiB,GAActB,EAAIuC,YAEbxB,KAAKL,QAAQV,EAAIwC,aACjB9B,QAAS,OACTH,QAAQkC,KApIR,SAwID1B,KAAKL,QAAQV,EAAI0C,gBAChBhC,QAAS,OACTH,QAAQkC,KAxIJ,YA4ITnB,GAAcc,EAAgBpC,EAAI2C,eAE7B5B,KAAKJ,WAAWX,EAAI4C,gBACpBjC,WAAY,OACZJ,QAAQkC,KAjJL,YAqJJ1B,KAAKJ,WAAWX,EAAI6C,mBACnBlC,WAAY,OACZJ,QAAQkC,KArJD,sDA6JXpC,WAAakB,OAAOA,OAAOuB"}